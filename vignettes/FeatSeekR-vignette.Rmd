---
title: "`FeatSeekR` user guide"
author: 
- name: Tuemay Capraz
  affiliation: European Molecular Biology Laboratory, Heidelberg
  email: tuemay.capraz@embl.de
package: FeatSeekR
date: "`r Sys.Date()`"
output:  
    BiocStyle::html_document:
        toc_float: true
vignette: >
    %\VignetteIndexEntry{`FeatSeekR` user guide}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignettePackage{FeatSeekR-vignette}
    %\VignetteEncoding{UTF-8}
---



```{r setup, message=FALSE}
library(FeatSeekR)
library(DmelSGI)
library(resample)
library(pheatmap)
library(ggplot2)
```


# Introduction

A fundamental step in many analyses of high-dimensional data is dimension 
reduction. Feature selection is one approach to dimension reduction whose 
strengths include interpretability, conceptual simplicity, transferability 
and modularity.
Here, we introduce the FeatSeekR algorithm, which selects features based on 
the consistency of their signal across replicates and their non-redundancy.
It takes a 3 dimensional array (samples x features x replicates) 
or a list of replicate matrices/dataframes (samples x features)  as input 
and returns a dataframe storing the selected and ranked features and 
their replicate correlations.

# Installation

```{r, eval=FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("FeatSeekR")
```

# Selecting image features from the `DmelSGI` package

Here we use FeatSeekR to rapidly identify unique features with reproducible 
signal between measurements in an image dataset from the `DmelSGI` package. 
The authors of `DmelSGI` performed combinatorial gene knock-outs using siRNA, 
followed by imaging of the cells. The resulting images were segmented and 
features were extracted using the `EBImage` package. 

```{r, load_data}
# load data
data("subSampleForStabilitySelection", package="DmelSGI")
data <- subSampleForStabilitySelection$D
# make sure dimensions are samples x features x replicates
data <- aperm(data, c(1,3,2))
# set feature names
dimnames(data)[[2]] <- subSampleForStabilitySelection$phenotype
dim(data)
```

The input data is a 3 dimensional array with 3000 samples, 162 features and 2
replicates.

```{r plot data}
# plot correlation matrix of the first 100 features of one of the replicates
cor_mat <- cor(data[,1:100,1])
pheatmap(cor_mat, show_rownames = FALSE, show_colnames = FALSE,
    treeheight_row = 0, treeheight_col = 0)
```

When plotting the correlation matrix of the features, we can see that many 
features are highly correlated and form redundant feature clusters. We apply 
FeatSeek to identify unique features with high replicate consistency.

```{r select_features}
# select up to 50 features
max_features <- 50
res <- FeatSeek(data, max_features = max_features)
```

We can further inspect the selected features by plotting the fraction of explained variance per selected feature.

```{r inspect_selection}
plotVarianceExplained(res)
```
We select the number of features that explain at least 70% of the total variance
and plot their correlation matrix.

```{r}
# get number of features which explain at least 70% of the total variance
n_feat <- min(which(res$explained_variance > 0.7))

plotSelectedFeatures(data,res, n_features = n_feat)
```


# Session Info

```{r}
sessionInfo()
```

